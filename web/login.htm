<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="UTF-8">
		<title>Space Tycoon</title>
		<link rel="stylesheet" href="style.css">
		<script src="https://d3js.org/d3.v7.min.js"></script>
	</head>
	<body>
		<nav>
			<a href="index.htm">Home</a>
		</nav>
		<hr>
		<form>
			<table>
				<tr>
					<td>
						<label for="username">User name:</label>
					<td>
						<input type="text" id="username" name="username" oninput="loginValidate(0)">
				</tr>
				<tr>
					<td>
						<label for="password">Password:</label>
					<td>
						<input type="password" id="password" name="password" oninput="loginValidate(1)">
				</tr>
				<tr>
					<td>
						<label for="player">Player name:</label>
					<td>
						<input type="text" id="player" name="player" oninput="loginValidate(2)">
				</tr>
				<tr>
					<td>
					<td>
						<input type="button" value="Log in" onclick="loginSubmit()">
				</tr>
				<tr>
					<td>
						Response:
					<td id="response">
				</tr>
			</table>
		</form>
		<script>
			function loginValidate(which) {
				let u = d3.select("#username").node().value
				let ps = d3.select("#password").node().value
				let pl = d3.select("#player").node().value
				if (u.length == 0) {
					d3.select("#response").text("invalid user name")
					return false
				}
				if (ps.length == 0) {
					d3.select("#response").text("invalid password")
					return false
				}
				if (pl.length == 0) {
					d3.select("#response").text("invalid player name")
					return false
				}
				d3.select("#response").text("")
				return true
			}
			function loginSubmit() {
				if (!loginValidate(-1))
					return
				d3.json("http://localhost/login", {
					method: "POST",
					body: JSON.stringify({
						username: d3.select("#username").node().value,
						password: d3.select("#password").node().value,
						player: d3.select("#player").node().value
					}),
					headers: {
						"Content-type": "application/json; charset=UTF-8"
					},
					credentials: "include"
				})
				.then(json => {
					d3.select("#response").text(JSON.stringify(json))
					document.cookie = "player-id=" + json.id + "; path=/";
				})
				.catch(err => {
					d3.select("#response").text(err)
				})
			}
		</script>
	</body>
</html>
